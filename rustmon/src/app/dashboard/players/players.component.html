<p-table #dt [value]="playerList" [columns]="playerCols"  [paginator]="true" [rows]="15"  [resizableColumns]="true"  [(contextMenuSelection)]="selectedPlayer" [contextMenu]="cm">
  <ng-template pTemplate="caption">
    <div style="vertical-align: middle;float: left;">
      Online <p-inputSwitch [(ngModel)]="onlyOnline" (onChange)="changeOnlineFilter($event)"></p-inputSwitch>
    </div>
    <div style="display: inline-block;text-align: right;margin-left: 15px;">
      <input type="text" pInputText size="50" placeholder="Search Players" (input)="dt.filterGlobal(getStringFromInputEvent($event), 'contains')" style="width:auto">
    </div>
  </ng-template>
  <ng-template pTemplate="header">
    <tr>
        <th *ngFor="let col of playerCols"  [pSortableColumn]="col.field" [style.width]="col.width" pResizableColumn> <!-- -->
          {{col.header}}
          <p-sortIcon [field]="col.field" ariaLabel="Activate to sort" ariaLabelDesc="Activate to sort in descending order" ariaLabelAsc="Activate to sort in ascending order"></p-sortIcon>
        </th>
    </tr>
  </ng-template>
  <ng-template pTemplate="body" let-player let-columns="columns">
      <tr [class.offline]="!player.online" (click)="showPlayerData($event, player, opPlayer)">
          <td *ngFor="let col of columns" [pContextMenuRow]="player">
            <span class="time" *ngIf="col.field == 'ConnectedSeconds' && player.online">{{player.ConnectedSeconds | uptimeFixed}}</span>
            <span class="hp" *ngIf="col.field == 'Health'" [class.greenText]="player.Health > 50" [class.yellowText]="player.Health <= 50 && player.Health >= 20" [class.redText]="player.Health < 20">
              {{player.Health | number:'1.0-0'}}
            </span>
            <span class="ip" *ngIf="col.field == 'Address'">
              {{player.Address | portRemove}}
            </span>
            <span class="ping" *ngIf="col.field == 'Ping' && player.online" [class.greenText]="player.Ping < 75" [class.yellowText]="player.Ping <= 170 && player.Ping >= 75" [class.redText]="player.Ping > 170">
              {{player.Ping}}
            </span>
            <span class="username" *ngIf="col.field == 'DisplayName'" style="color:#55aaff">
              <img *ngIf="player.country && player.country != 'N/D'" [src]="'https://flagpedia.net/data/flags/w580/' + player.country + '.png'" style="width: 20px;" [title]="player.country" />
              {{player.DisplayName}}
              <div class="warns">
                <svg title="Private Profile" *ngIf="!player.steamData || player.steamData.communityvisibilitystate != 3" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="eye-slash" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512" class="privateIcon"><path fill="currentColor" d="M320 400c-75.85 0-137.25-58.71-142.9-133.11L72.2 185.82c-13.79 17.3-26.48 35.59-36.72 55.59a32.35 32.35 0 0 0 0 29.19C89.71 376.41 197.07 448 320 448c26.91 0 52.87-4 77.89-10.46L346 397.39a144.13 144.13 0 0 1-26 2.61zm313.82 58.1l-110.55-85.44a331.25 331.25 0 0 0 81.25-102.07 32.35 32.35 0 0 0 0-29.19C550.29 135.59 442.93 64 320 64a308.15 308.15 0 0 0-147.32 37.7L45.46 3.37A16 16 0 0 0 23 6.18L3.37 31.45A16 16 0 0 0 6.18 53.9l588.36 454.73a16 16 0 0 0 22.46-2.81l19.64-25.27a16 16 0 0 0-2.82-22.45zm-183.72-142l-39.3-30.38A94.75 94.75 0 0 0 416 256a94.76 94.76 0 0 0-121.31-92.21A47.65 47.65 0 0 1 304 192a46.64 46.64 0 0 1-1.54 10l-73.61-56.89A142.31 142.31 0 0 1 320 112a143.92 143.92 0 0 1 144 144c0 21.63-5.29 41.79-13.9 60.11z" class=""></path></svg>
                <svg title="VAC" *ngIf="player.vac?.VACBanned" aria-hidden="true" focusable="false" data-prefix="fas" data-icon="exclamation-triangle" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" class="vacIcon"><path fill="currentColor" d="M569.517 440.013C587.975 472.007 564.806 512 527.94 512H48.054c-36.937 0-59.999-40.055-41.577-71.987L246.423 23.985c18.467-32.009 64.72-31.951 83.154 0l239.94 416.028zM288 354c-25.405 0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346l7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373 0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884 0-12.356 5.78-11.981 12.654z" class=""></path></svg>
              </div>
            </span>
          </td>
      </tr>
  </ng-template>
</p-table>
<p-contextMenu #cm [model]="ctxMenu"></p-contextMenu>
<p-toast position="top-right"></p-toast>
<p-confirmDialog icon="pi pi-exclamation-triangle" [baseZIndex]="10000"></p-confirmDialog>

<p-overlayPanel #opPlayer>
  <ng-template pTemplate>
    <div class="overlaypanel">
      <p>
        <img [src]="playerClicked.steamData.avatar" class="avatar"/>
        <button class="clearCacheButton" (click)="clearCache(playerClicked.SteamID)">Clear Cache</button>
      </p>
      <p>
        <label>SteamID</label>
        {{playerClicked.steamData.steamid}}
      </p>
      <p>
        <label>Profile</label>
        <span *ngIf="!playerClicked.steamData || playerClicked.steamData.communityvisibilitystate != 3" class="yes">&nbsp;Private</span>
        <span *ngIf="playerClicked.steamData && playerClicked.steamData.communityvisibilitystate == 3">&nbsp;Public</span>
      </p>
      <p *ngIf="playerClicked.steamData">
        <label>Created account</label>
        {{playerClicked.steamData.timecreated * 1000 | date:'d/M/yy'}}
      </p>
      <p *ngIf="playerClicked?.vac">
        <label>Community Banned</label>
        <span class="yes" *ngIf="playerClicked?.vac?.CommunityBanned">
          YES
        </span>
        <span class="no" *ngIf="!playerClicked?.vac?.CommunityBanned">
          NO
        </span>
      </p>
      <p *ngIf="playerClicked?.vac">
        <label>VAC Ban</label>
        <span class="yes" *ngIf="playerClicked?.vac?.VACBanned">
          YES ({{playerClicked?.vac?.NumberOfVACBans}})
        </span>
        <span class="no" *ngIf="!playerClicked?.vac?.VACBanned">
          NO
        </span>
      </p>
      <p *ngIf="playerClicked?.vac">
        <label>Days since last ban</label>
        <span>
          {{playerClicked?.vac?.DaysSinceLastBan}}
        </span>
      </p>
      <p *ngIf="playerClicked?.vac">
        <label>Game bans</label>
        <span>
          {{playerClicked?.vac?.NumberOfGameBans}}
        </span>
      </p>
      <p *ngIf="playerClicked?.vac">
        <label>Economy ban</label>
        <span>
          {{playerClicked?.vac?.EconomyBan}}
        </span>
      </p>
    </div>
  </ng-template>
</p-overlayPanel>
